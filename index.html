<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>MiniCraft 3D GitHub</title>
<style>
  body { margin:0; overflow:hidden; background:#87CEEB; }
  #menu { 
    position:absolute; inset:0; 
    display:flex; flex-direction:column; 
    justify-content:center; align-items:center; 
    background:#111; color:white; font-family:Arial; z-index:10;
  }
  button { padding:15px 40px; font-size:20px; cursor:pointer; margin-top:20px; }
</style>
</head>
<body>

<div id="menu">
  <h1>MiniCraft 3D Browser</h1>
  <button onclick="startGame()">Play</button>
</div>

<audio id="bgMusic" loop>
  <source src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_07f24f1c27.mp3?filename=game-loop-112654.mp3" type="audio/mpeg">
</audio>

<script src="https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.min.js"></script>

<script>
let scene, camera, renderer, player;
let keys = {};
let npcs = [];

const menu = document.getElementById("menu");
const bgMusic = document.getElementById("bgMusic");

function startGame(){
  menu.style.display="none";
  bgMusic.play();

  // Сцена
  scene = new THREE.Scene();

  // Камера
  camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);

  // Рендер
  renderer = new THREE.WebGLRenderer();
  renderer.setSize(window.innerWidth, window.innerHeight);
  document.body.appendChild(renderer.domElement);

  // Свет
  const light = new THREE.DirectionalLight(0xffffff, 1);
  light.position.set(10,20,10);
  scene.add(light);

  // Биомы
  const size = 30;
  for(let x=-size/2;x<size/2;x++){
    for(let z=-size/2;z<size/2;z++){
      let color=0x3a7d44; // трава
      if(x<0 && z<0) color=0xffffa0; // песок
      if(x>0 && z>0) color=0xffffff; // снег
      const geo = new THREE.BoxGeometry(1,1,1);
      const mat = new THREE.MeshStandardMaterial({color});
      const cube = new THREE.Mesh(geo,mat);
      cube.position.set(x,0,z);
      scene.add(cube);
    }
  }

  // Вода
  const waterGeo = new THREE.BoxGeometry(10,0.5,10);
  const waterMat = new THREE.MeshStandardMaterial({color:0x1e90ff, transparent:true, opacity:0.7});
  const water = new THREE.Mesh(waterGeo, waterMat);
  water.position.set(-10,0.25,10);
  scene.add(water);

  // Игрок
  const playerGeo = new THREE.BoxGeometry(1,2,1);
  const playerMat = new THREE.MeshStandardMaterial({color:0xff0000});
  player = new THREE.Mesh(playerGeo,playerMat);
  player.position.set(0,1,0);
  scene.add(player);

  // NPC
  for(let i=0;i<5;i++){
    const npcGeo = new THREE.BoxGeometry(1,2,1);
    const npcMat = new THREE.MeshStandardMaterial({color:0x00ff00});
    const npc = new THREE.Mesh(npcGeo,npcMat);
    npc.position.set(Math.random()*20-10,1,Math.random()*20-10);
    npcs.push({mesh:npc,dir:Math.random()*Math.PI*2});
    scene.add(npc);
  }

  animate();
}

// Управление
document.addEventListener('keydown',(e)=>keys[e.key.toLowerCase()]=true);
document.addEventListener('keyup',(e)=>keys[e.key.toLowerCase()]=false);

function animate(){
  requestAnimationFrame(animate);

  const speed = 0.1;
  if(keys['w']) player.position.z -= speed;
  if(keys['s']) player.position.z += speed;
  if(keys['a']) player.position.x -= speed;
  if(keys['d']) player.position.x += speed;

  // Камера
  camera.position.set(player.position.x, player.position.y + 2, player.position.z + 5);
  camera.lookAt(player.position);

  // NPC движение
  npcs.forEach(n=>{
    n.mesh.position.x += Math.cos(n.dir)*0.02;
    n.mesh.position.z += Math.sin(n.dir)*0.02;
    if(Math.random()<0.01) n.dir += (Math.random()-0.5)*Math.PI/2;
  });

  renderer.render(scene,camera);
}

window.addEventListener('resize',()=>{
  if(renderer && camera){
    camera.aspect = window.innerWidth/window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth,window.innerHeight);
  }
});
</script>

</body>
</html>
